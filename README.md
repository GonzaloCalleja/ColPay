# ColPay
## Prototype Development
In order to complete my capstone project, a prototype was developed as a proof of concept for the ColPay product. The prototype is publicly accessible, employs blockchain technology, and provides the user with all the functionalities for the product described in the Business Plan using an internal cryptocurrency CP Tokens, as opposed to real money as the final product will.
### 1. Prototype Deployment
#### 1.1 Code Repository.
The code for the prototype has been published in this GitHub public repository under the MIT license, and can be accessed following this link: https://github.com/GonzaloCalleja/ColPay.
Since the project involves several different technologies, there are 38 files, so creating the right folder structure has been critical. The repository has configuration files, such as Package.json for dependencies and truffle-config.json for blockchain network connectivity. And also also 5 folders: (1) Migrations for handling the deployment of smart contracts, (2) public to direct the server to the React JS code, (3) scripts to automate administrative tasks, (4) test for testing all the smart contracts, and (5) src which is the most relevant folder, as it contains the the smart contracts (.sol), the JSON representation of the contracts (abis), and all frontend files (.js).
#### 1.2 Using the prototype.
The prototype requires the use of the extension Metamask, which is a digital wallet for Ethereum network. After installing it, and creating a wallet, the user has to connect to the Ropsten Test Network, which unlike the Ethereum Mainnet does not cost money. Finally, users need an account with Ether, so in the document, I have provided the private key of 5 accounts with test Ether in Exhibit 18. They can be imported into the users Metamask wallet, so they can use the prototype. Those addresses already have some contract in the ColPay platform, so the user can review them.
The link to access the prototype is the following: https://gonzalocalleja.github.io/ColPay/, it leads the user to the ColPay landing page, they can then chose to log-in (a process validated by Metamask), to access the ColPay application dashboard, to create contracts and make payments.
### 2. Technology Employed
The technologies employed in the prototype development differ from those specified in the Product Development section of the Business Plan because the prototype serves as a proof of concept for the smart contract algorithm, so it does not require a permissioned blockchain developed internally..
#### 2.1. Backend development
##### 2.1.1. Tools Employed.
The backend for this prototype consists of the smart contracts developed in Solidity, which handle all the logic for the payment fragmentation. In order to test and deploy the contracts the Truffle development environment was used, along with the Ganache personal blockchain. However in order to make the prototype publicly available, it was necessary to deploy the contracts to a public blockchain, since Ganache only runs locally. For this the Infura Ethereum API was used, to deploy the contracts to the Ropsten Test Network.
##### 2.1.2. Algorithm for controlling payment fragmentation.
The underlying magic of the ColPay product relies on the sellerâ€™s ability to request payments from the buyer when certain conditions are met. In the prototype the conditions for are defined when the contract is created as Days to Open and Speed. The way the algorithm for transactions works is that if Days to Open has passed since the start of the contract, and the amount requested does not exceed the Total Amount Owed * % of Contract Time Elapsed * Speed then the transaction is executed successfully. In the final product, the application will also require the seller to upload an invoice as a way to justify their need for payment.
##### 2.1.3 Contract Code Structure.
This code for the contract can be found in the src/contracts/ColPay.sol file. The initial part declares all the necessary data structures to represent contracts and transactions. Then there are several public methods that update the values in those structures: (1) create a contract, (2) accept a contract, (3) reject a contract, (4) expire a contract, and (5) make a transaction. Finally, there are 2 methods that are only for the contract emitter (administrator), and can be executed using scripts: (1) Issue tokens to accounts, (2) check for required payments. All methods have require statements, which serve to control that they are only executed under certain conditions, this is critical, since changes to the blockchain state cannot be taken back, and have to be very carefully controlled.
##### 2.1.4. Testing Prototype Functionality.
Testing smart contracts before deployment is extremely important, since once deployed the smart contract code is immutable. For this purpose, tests were created for every method using the testing functionality of Truffle. The output of the tests can be seen bellow.
#### 2.2 Frontend development
##### 2.2.1. Tools Employed.
The frontend part of the prototype uses the Web3 API to connect to the users Metamask wallet and execute transactions in the blockchain network, and the GitHub pages service to host the website. As for the User Interface itself, it was developed using React JS and the Material UI library, which are 2 open source tools employed by frontend developers nowadays.
##### 2.2.2. UX/UI Design.
The website is designed to be intuitive and provide the best User Experience possible based on the Customer Journey defined in the Business Plan. It is divided into 2 clear sections. Firstly the Landing Page shown in Exhibit 22, which communicates the ColPay brand with new users and secondly the Application Page shown in Exhibit 23, allows existing users to interact with the product. The application dashboard is divided into 9 sections, each with a clear purpose. On top of that, special care has been placed in designing the more complex user actions such as creating a contract, which has been divided into 4 short steps instead of a long form. Throughout the website, a color palette based on the color #3a8f69, is used to represent the ColPay brand.
##### 2.2.3. Code Structure.
The main page of the React JS application is the App.js file, and it serves the purpose of routing the user to the Landing page or the Application page depending on the URL. The Application page (ColPayAppLogic.js) is the most important component, since it handles the Web3 API connection, and updates all the state variables. The rest of the code has been divided into the main components which represent each of the sections in the Application dashboard, and the small components which represent all minor components used in those pages. Any other component used but not included coded is from external libraries, i.e.: Material UI Buttons.
### 3. Future Improvements
Future versions of the prototype could get closer to the real product through 3 key improvements. Firstly, by implementing a backend to handle the user data that is not stored in the blockchain (such as user names), because storing them in the frontend application is inefficient and not secure. Secondly, the prototype could employ an internal wallet instead of relying on Metamask, since this is a burden on the user at the moment. And finally, the code for the ColPay smart contract could be made more efficient, as a way to reduce the contract deployment gas cost, by adapting the data structures used so they are more efficient.
### Outup of Truffle Tests
![Screenshot 2021-05-31 at 10 37 08](https://user-images.githubusercontent.com/37070611/120166495-ec946680-c1fc-11eb-9c0b-848e02b1d3ff.png)
